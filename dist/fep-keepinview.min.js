/*! fep-keepinview - v1.0.0-alpha - 2013-12-13
* https://github.com/dutchcelt/fep-keepinview
* Copyright (c) 2013 Egor Kloos; Licensed GPL v3 */
(function(t){"function"==typeof define&&define.amd?define(["FEP-KeepInView"],t):t(window)})(function(){window.FEP=window.FEP||{},FEP.KeepInView=function(t,i,s){var o=Object.create(FEP.KeepInView.object);if(o.options=Object.create(o.defaults),"object"==typeof i)for(var n in i)o.options[n]=i[n];return e(t).forEach(function(t){var e=Object.create(o);e.stickyElem=t,e.index=FEP.KeepInView.object.index++,e.init(s)})};var t=function(t,e){var i;try{i=new CustomEvent(t,{bubbles:!0,cancelable:!0,returnValue:!1,detail:e})}catch(s){i=document.createEvent("CustomEvent"),i.initCustomEvent(t,!0,!0,e)}finally{return i}},e=function(t,e){return Array.prototype.slice.call((e||document).querySelectorAll(t))},i=function(t){var e=RegExp("(?:^|\\s)"+t+"(?!\\S)","g");return e},s=function(t,s){e("."+t,s).forEach(function(e){e.className=e.className.replace(i(t),"")})},o=function(t,e){i(e).test(t.className)||(t.className+=(""===t.className?"":" ")+e)},n=function(t,e){e=e||t.getBoundingClientRect();var i={},s=function(e){var i=0,s=parseInt(getComputedStyle(t)[e]);return i=getComputedStyle(t)[e].indexOf("rem")>-1?parseInt(getComputedStyle(document.body).fontSize)/16*s:0>getComputedStyle(t)[e].indexOf("px")?parseInt(getComputedStyle(t).fontSize)/16*s:s};for(var o in e)i[o]=Math.round(e[o]),"top"===o&&(i[o]=i[o]-s("marginTop")),"left"===o&&(i[o]=i[o]-s("marginLeft")),t[o]=i[o];return i},h=function(t,e){for(var i in e)t.style[i]=e[i]};FEP.KeepInView.object={namespace:"kiv",ticking:!1,index:0,$elem:null,$parent:null,defaults:{fixed:!1,edgeOffset:0,zindex:"auto",customClass:!1,trigger:"both",scrollable:!1,h:0,w:0,offsetAnchor:!1,cloned:!1},options:{},setElem:function(){if(this.stickyElem.offsetHeight>window.innerHeight&&!this.options.scrollable)return!1;this.options.clearStyle&&this.elem.removeAttribute("style");var t="",e=window.innerHeight;this.elem.height,parseInt(this.elem.top+this.elem.height-Math.abs(window.pageYOffset)+this.options.edgeOffset,10)>e&&!this.options.fixed&&(t="bottom"),window.pageYOffset>this.elem.top-this.options.edgeOffset&&!this.options.fixed&&(t="top"),this.options.customClass?this.options.customClass&&("both"===this.options.trigger?"bottom"===t||"top"===t?o(this.elem,this.options.customClass+"-"+t):t||(s(this.options.customClass+"-top",this.elem),s(this.options.customClass+"-bottom",this.elem)):t===this.options.trigger?o(this.elem,this.options.customClass+"-"+this.options.trigger):t||s(this.options.customClass+"-"+this.options.trigger,this.elem)):(this.options.scrollable?this.prepCSS({height:e-this.elem.top+"px",overflow:"auto"}):this.prepCSS(),"bottom"!==t||"both"!==this.options.trigger&&"bottom"!==this.options.trigger?"top"!==t||"both"!==this.options.trigger&&"top"!==this.options.trigger?this.options.fixed?h(this.elem,{top:this.options.edgeOffset+"px",left:this.elem.left,height:"auto"}):this.options.scrollable?h(this.elem,{position:this.position,top:this.elem.top+"px",left:this.elem.left+"px",width:this.elem.width+"px",height:e-this.elem.top+window.pageYOffset+"px"}):this.options.offsetAnchor?(h(this.stickyElem,{visibility:"visible"}),h(this.elem,{display:"none"})):this.elem.removeAttribute("style"):this.options.scrollable?this.prepCSS({height:e+"px",top:this.options.edgeOffset+"px",overflow:"auto"}):this.fixCSS(this.options.edgeOffset):this.options.scrollable?this.prepCSS({height:e+"px",top:e-this.elem.height-this.options.edgeOffset+"px",overflow:"auto"}):this.fixCSS(e-this.elem.height-this.options.edgeOffset)),this.ticking=!1},cssObject:function(){return{position:"fixed",left:this.elem.left+"px",width:this.options.scrollable?this.elem.width+"px":this.elem.width+"px",height:this.options.scrollable?window.innerHeight-this.elem.top+"px":this.elem.height+"px",zIndex:this.options.zindex}},prepCSS:function(t){cssObj=Object.create(this.cssObject.call(this));for(var e in t)cssObj[e]=t[e];h(this.elem,cssObj)},fixCSS:function(t){this.elem.style.top=t+"px",this.options.offsetAnchor&&(this.stickyElem.style.visibility="hidden",this.elem.style.display="block")},update:t("update"),unstick:t("unstick"),set:t("set"),staySticky:function(){n(this.elem),this.options.clearStyle=!0,this.ticking||requestAnimationFrame(this.setElem.bind(this))},setElemRequest:function(){o(this.elem,this.namespace+"-"+this.index),this.options.clearStyle=!1,this.ticking||requestAnimationFrame(this.setElem.bind(this))},killSticky:function(){this.elem.removeEventListener("update",this,!0),this.elem.removeEventListener("set",this,!0),this.elem.removeAttribute("style")},handleEvent:function(t){switch(t.type){case"update":this.staySticky();break;case"set":this.setElemRequest();break;case"unstick":this.killSticky();break;case"resize":this.elem.dispatchEvent(this.update);break;case"scroll":this.elem.dispatchEvent(this.set)}this.ticking=!0},anchorShifter:function(){if(this.options.offsetAnchor){var t=e("a[name]"),i=function(){var e=+new Date;do{var s=t.shift();void 0!==t[0]&&$(s).css({position:"relative",display:"block",top:"-"+this.box.height+"px"})}while(void 0!==t[0]&&50>+new Date-e);void 0!==t[0]&&setTimeout(i,0)};i()}},init:function(t){this.options.zindex=getComputedStyle(this.stickyElem).zIndex,this.options.cloned?(this.elem=this.stickyElem.cloneNode(!0),this.stickyElem.parentNode.insertBefore(this.elem,this.stickyElem),o(this.elem,this.namespace+"-cloned"),o(this.stickyElem,this.namespace+"-original")):this.elem=this.stickyElem,n(this.elem,this.stickyElem.getBoundingClientRect()),this.position=getComputedStyle(this.stickyElem).position,this.elem.addEventListener("update",this,!0),this.elem.addEventListener("unstick",this,!0),this.elem.addEventListener("set",this,!0),window.addEventListener("resize",this,!0),window.addEventListener("scroll",this,!0),this.elem.dispatchEvent(this.set),this.anchorShifter(),"function"==typeof t&&t(this)}},FEP.KeepInView.unstick=FEP.KeepInView.object.unstick});